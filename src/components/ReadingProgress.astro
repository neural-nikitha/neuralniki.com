---
// ReadingProgress.astro - Reading progress bar
---

<div
  id="reading-progress"
  class="fixed top-0 left-0 h-1 z-[100] transition-all duration-150"
  style="width: 0%; background: linear-gradient(90deg, var(--color-primary-500), var(--color-lavender-500));"
  role="progressbar"
  aria-valuenow="0"
  aria-valuemin="0"
  aria-valuemax="100"
  aria-label="Reading progress"
></div>

<script>
  function initReadingProgress() {
    const progressBar = document.getElementById('reading-progress');
    if (!progressBar) return;
    
    let ticking = false;
    
    const updateProgress = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = docHeight > 0 ? Math.min((scrollTop / docHeight) * 100, 100) : 0;
      
      progressBar.style.width = `${scrollPercent}%`;
      progressBar.setAttribute('aria-valuenow', scrollPercent.toFixed(0));
    };
    
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          updateProgress();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
    
    // Initial update
    updateProgress();
  }
  
  // Initialize on load
  initReadingProgress();
  
  // Re-initialize after Astro page transitions
  document.addEventListener('astro:after-swap', initReadingProgress);
</script>
