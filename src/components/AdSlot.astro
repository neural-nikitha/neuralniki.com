---
// AdSlot.astro - Google AdSense-ready ad container with CLS prevention
export interface Props {
  type?: 'in-article' | 'sidebar' | 'after-content' | 'mid-content';
  format?: 'auto' | 'fluid' | 'rectangle';
  className?: string;
}

const { type = 'in-article', format = 'auto', className = '' } = Astro.props;

// Ad dimensions based on type - prevents CLS
const adConfig = {
  'in-article': { 
    minHeight: '280px', 
    description: 'In-article native ad'
  },
  'sidebar': { 
    minHeight: '600px', 
    description: 'Sidebar display ad'
  },
  'after-content': { 
    minHeight: '250px', 
    description: 'Post-article ad'
  },
  'mid-content': { 
    minHeight: '280px', 
    description: 'Mid-content native ad'
  },
};

const config = adConfig[type];

// Generate unique ID for this ad slot
const adId = `ad-${type}-${Math.random().toString(36).substring(7)}`;
---

<aside 
  class:list={[
    "ad-slot relative overflow-hidden rounded-xl",
    className
  ]}
  style={`min-height: ${config.minHeight}; background-color: var(--bg-secondary); border: 1px dashed var(--border-primary);`}
  data-ad-type={type}
  data-ad-format={format}
  aria-label="Advertisement"
  role="complementary"
>
  <!-- Placeholder content (shown until AdSense loads) -->
  <div class="ad-placeholder absolute inset-0 flex flex-col items-center justify-center p-6 text-center">
    <span class="ad-label text-xs font-medium uppercase tracking-widest mb-2" style="color: var(--text-muted);">
      Advertisement
    </span>
    <span class="text-xs" style="color: var(--text-muted);">
      {config.description}
    </span>
  </div>
  
  <!-- 
    Google AdSense Ad Unit
    Replace the data-ad-client and data-ad-slot with your actual AdSense values
    
    Instructions:
    1. Sign up for Google AdSense at https://www.google.com/adsense/
    2. Get approved for ads
    3. Create an ad unit in your AdSense dashboard
    4. Replace the placeholder values below with your ad unit details
  -->
  <div id={adId} class="ad-content relative z-10">
    <!-- 
    <ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
      data-ad-slot="XXXXXXXXXX"
      data-ad-format={format}
      data-full-width-responsive="true">
    </ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    -->
  </div>
</aside>

<style>
  .ad-slot {
    transition: background-color var(--transition-slow), border-color var(--transition-slow);
  }
  
  /* Hide placeholder when ad loads */
  .ad-slot:has(.adsbygoogle[data-ad-status="filled"]) .ad-placeholder {
    display: none;
  }
  
  /* Style for unfilled ads */
  .ad-slot:has(.adsbygoogle[data-ad-status="unfilled"]) {
    display: none;
  }
</style>
