---
// SharePill.astro - Share article and copy link
export interface Props {
  slug: string;
  title: string;
}

const { slug, title } = Astro.props;
---

<div class="share-container relative">
  <button
    id="shareButton"
    class="share-button group relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300"
    style="background-color: var(--bg-tertiary);"
    aria-label="Share this article"
    data-slug={slug}
    data-title={title}
  >
    <svg
      class="w-5 h-5 transition-all duration-300 group-hover:scale-110"
      style="color: var(--text-tertiary);"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
      />
    </svg>
    
    <!-- Copied toast -->
    <span
      id="copiedToast"
      class="absolute -top-12 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-lg text-xs font-medium text-white whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300"
      style="background-color: var(--color-success);"
    >
      âœ“ Link copied!
    </span>
  </button>
</div>

<style>
  .share-button:hover {
    background-color: var(--bg-secondary) !important;
  }
  
  .share-button:hover svg {
    color: var(--accent-primary) !important;
  }
  
  .share-button:active {
    transform: scale(0.95);
  }
</style>

<script>
  function initShareButton() {
    const button = document.getElementById('shareButton');
    const toast = document.getElementById('copiedToast');
    
    if (!button || !toast) return;
    
    async function handleShare() {
      const slug = button.getAttribute('data-slug');
      const title = button.getAttribute('data-title');
      const url = `${window.location.origin}/posts/${slug}`;
      
      // Try native share first (mobile)
      if (navigator.share) {
        try {
          await navigator.share({
            title: title || 'Check out this article',
            url: url
          });
          return;
        } catch (err) {
          // User cancelled or error, fall through to clipboard
        }
      }
      
      // Fallback to clipboard
      try {
        await navigator.clipboard.writeText(url);
        
        // Show toast
        toast.classList.remove('opacity-0');
        toast.classList.add('opacity-100');
        
        setTimeout(() => {
          toast.classList.remove('opacity-100');
          toast.classList.add('opacity-0');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    }
    
    button.addEventListener('click', handleShare);
  }
  
  // Initialize on load
  initShareButton();
  
  // Re-initialize after Astro page transitions
  document.addEventListener('astro:after-swap', initShareButton);
</script>
